<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <title>LongPressButton</title>

    <style type="text/css">
    .pie {
        position: relative;
        margin-right: auto;
        margin-left: auto;
        width: 100px;
        height: 100px;
        background-image: conic-gradient(#d5525f 0% 0%, #d9d9d9 0% 100%);
        border-radius: 50%;
    }
    .pie span {
        position: absolute;
        top: 50%;
        right: 50px;
        transform: translateY(-50%);
        color: #fff;
    }
    .btn {
        text-align: center;
        background-color: #676767;
        width: 80px;
        height: 80px;
        border-radius: 50%;
        position: relative;
        top: 10px;
        left: 10px;
        user-select: none;
    }
    </style>
</head>
<body>

    <div>
        <label>カラー</label>
        <input type="color" value="#ffb128" id="colorPalette">
    </div>
    <div>
        <label>タイマー</label>
        <input type="number" value="3" id="timer"  min="0">
    </div>

    <div>
        <label>サイズ</label>
        <input type="number" value="100" id="size"  min="0">
    </div>

    <div id="pie" class="pie">
        <div id="pie-btn" class="btn"></div>
    </div>
</body>
</html>

<script type="text/javascript">

const longPress = {
    //プロパティ
    el: '',
    el2: '',
    count: 0,
    second: 1,
    interval: 10,
    timerId: 0,
    color: 'red',
    size: 100,
    callback: '',

    //メソッド
    init: function(param){
        //引数のパラメータ取得
        this.el = document.querySelector(param.el);
        this.el2 = document.getElementById("pie");
        this.second = param.second;
        this.color = param.color;
        this.size = param.size;
        this.callback = param.callback;

        // this.pie = document.querySelector('#pie');
        this.el2.style.width = this.size +'px';
        this.el2.style.height = this.size +'px';

        this.piebtn = document.querySelector('#pie-btn');
        this.piebtn.style.width = this.size * 0.8 +'px';
        this.piebtn.style.height = this.size * 0.8 +'px';

        var pos = (this.size - this.size*0.8) / 2;
        this.piebtn.style.top = pos +"px";
        this.piebtn.style.left = pos +"px";

        //イベントリスナー
        this.el.addEventListener('pointerdown', ()=>{ this.start() }, false);
        this.el.addEventListener('pointerup', ()=>{ this.end() }, false);
        this.el.addEventListener('pointerout', ()=>{ this.end() }, false);
        this.el.oncontextmenu = () => {return false;}
    },
    start: function(){
        this.timerId = setInterval(()=>{
            this.count++;
            this.el2.style.backgroundImage = 'conic-gradient('+ this.color +' 0% '+ this.count/this.second +'%, #d9d9d9 0% 100%)';

            if (this.count / 100 === this.second) {
                //長押し判定時の処理
                this.callback();
            }
        }, this.interval);
    },
    end: function(){
        clearInterval(this.timerId);
        this.count = 0;
        this.el.style.backgroundColor = '#676767';
        this.el2.style.backgroundImage = 'conic-gradient(#ff0019 0% 0%, #d9d9d9 0% 100%)';
    },
    update: function(param){
        if (param.color) {
            this.color = param.color;
        }
        if (param.second) {
            this.second = param.second;
        }
        if (param.size) {

            this.el2.style.width = param.size +'px';
            this.el2.style.height = param.size +'px';

            this.piebtn = document.querySelector('#pie-btn');
            this.piebtn.style.width = param.size * 0.8 +'px';
            this.piebtn.style.height = param.size * 0.8 +'px';

            var pos = (param.size - param.size*0.8) / 2;
            this.piebtn.style.top = pos +"px";
            this.piebtn.style.left = pos +"px";
        }
    }
}

//初期化
longPress.init({
    el: '#pie-btn', //長押しの判定を取りたい要素のセレクタを指定する
    second: 3, //長押しの秒数を指定する
    color: 'rgb(255 177 40)',
    callback: function(){
        console.log('ボタンを' + this.second + '秒長押ししました！'); 
    },
    size: 100
});

//色の更新
var colorPalette = document.getElementById('colorPalette');
colorPalette.addEventListener("change", (event) => {
    longPress.update({
        color: colorPalette.value
    });
});

//時間の更新
var timer = document.getElementById('timer');
timer.addEventListener("change", (event) => {
    longPress.update({
        second: Number(timer.value)
    });
});

//時間の更新
var size = document.getElementById('size');
size.addEventListener("change", (event) => {
    longPress.update({
        size: Number(size.value)
    });
});

</script>
