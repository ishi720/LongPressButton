<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <title>LongPressButton</title>

    <style type="text/css">
    .pie {
        position: relative;
        margin-right: auto;
        margin-left: auto;
        width: 100px;
        height: 100px;
        background-image: conic-gradient(#d5525f 0% 0%, #d9d9d9 0% 100%);
        border-radius: 50%;
    }
    .pie span {
        position: absolute;
        top: 50%;
        right: 50px;
        transform: translateY(-50%);
        color: #fff;
    }
    .btn {
        text-align: center;
        background-color: #676767;
        width: 80px;
        height: 80px;
        border-radius: 50%;
        position: relative;
        top: 10px;
        left: 10px;
        user-select: none;
    }
    </style>
</head>
<body>
    <div id="pie" class="pie">
        <div id="pie-btn" class="btn"></div>
    </div>

    <div>
        <label>カラー</label>
        <input type="color" value="#ffb128" id="colorPalette">
    </div>
    <div>
        <label>タイマー</label>
        <input type="number" value="3" id="timer"  min="0">
    </div>
</body>
</html>

<script type="text/javascript">

const longPress = {
    //プロパティ
    el: '',
    el2: '',
    count: 0,
    second: 1,
    interval: 10,
    timerId: 0,
    color: 'red',
    callback: '',

    //メソッド
    init: function(param){
        //引数のパラメータ取得
        this.el = document.querySelector(param.el);
        this.el2 = document.getElementById("pie");
        this.second = param.second;
        this.color = param.color;
        this.callback = param.callback;

        //イベントリスナー
        this.el.addEventListener('pointerdown', ()=>{ this.start() }, false);
        this.el.addEventListener('pointerup', ()=>{ this.end() }, false);
        this.el.addEventListener('pointerout', ()=>{ this.end() }, false);
        this.el.oncontextmenu = () => {return false;}
    },
    start: function(){
        this.timerId = setInterval(()=>{
            this.count++;
            this.el2.style.backgroundImage = 'conic-gradient('+ this.color +' 0% '+ this.count/this.second +'%, #d9d9d9 0% 100%)';

            if (this.count / 100 === this.second) {
                //長押し判定時の処理
                this.callback();
            }
        }, this.interval);
    },
    end: function(){
        clearInterval(this.timerId);
        this.count = 0;
        this.el.style.backgroundColor = '#676767';
        this.el2.style.backgroundImage = 'conic-gradient(#ff0019 0% 0%, #d9d9d9 0% 100%)';
    },
    update: function(param){
        if (param.color) {
            this.color = param.color;
        }
        if (param.second) {
            this.second = param.second;
        }
    }
}

//初期化
longPress.init({
    el: '#pie-btn', //長押しの判定を取りたい要素のセレクタを指定する
    second: 3, //長押しの秒数を指定する
    color: 'rgb(255 177 40)',
    callback: function(){
        console.log('ボタンを' + this.second + '秒長押ししました！'); 
    }
});

//色の更新
var colorPalette = document.getElementById('colorPalette');
colorPalette.addEventListener("change", (event) => {
    longPress.update({
        color: colorPalette.value
    });
});

//時間の更新
var timer = document.getElementById('timer');
timer.addEventListener("change", (event) => {
    longPress.update({
        second: Number(timer.value)
    });
});


</script>
